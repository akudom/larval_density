---
title: "Larval density dependence"
author: "Andreas Kudom, Dave Hemprich-Bennett, Talya Hackett"
date: "06/07/2022"
output: bookdown::html_document2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(here)

# Rerun scripts
source(here('scripts', '1_larval_growth_rates.R'))
source(here('scripts', '2_larval_mortality.R'))       

# read in formatted df
larval_density_df <- read_csv(here('data', 'processed_data', '1_density_and_growth.csv')) 
sp <- larval_density_df %>% pull(species) %>% unique()
```

# Introduction

Andreas ran an experiment where containers had `r larval_density_df %>% pull(larval_density) %>% unique()` *Anopheles gambiae* eggs placed within them. 
`r larval_density_df %>% pull(replicate_no) %>% unique() %>% (length)` simultaneous replicates of different larval densities were performed, over `r larval_density_df %>% pull(date_of_experiment) %>% unique() %>% length()` iterations. 
Iterations either had `r sp[1]` or `r sp[2]` varieties used.  
Three sets of variables were measured:  

1. Number of larvae per surviving until pupation per replicate
2. For larvae that survived until pupation, number of days between hatching and:
    + pupation
    + eclosion
3. Wing length for a subset of larvae that survived until eclosion.


# Survival rates

Increasing the density of larvae in a container decreased the proportion of those larvae who survived (Figure \@ref(fig:prop-surv)), although the highest number of larvae survived in the containers with 60 larvae (Figure \@ref(fig:n-surv)).

```{r prop-surv, fig.cap="Proportion of larvae surviving."}
proportion_survival_boxplot
```



```{r n-surv, fig.cap="Number of larvae surviving.", echo = F}
number_surviving_boxplot
```

This data was analysed using a binomial generalised linear mixed-effects model, using the formula:   
*`r format(formula(survival_mod))`*.  
Or, in something closer to plain english:  
*survival (a binary variable) ~ larval density + larval 'species' + (1 | container)*  
Where larval density is being treated as a categorical variable.  

The model gave the following values (Table \@ref(tab:tidy-surv)).  
```{r tidy-surv, echo= F}
tidy(survival_mod) %>%
  knitr::kable(caption = 'tidy model' )
```

And the following confidence values (Table \@ref(tab:glance-surv)).

```{r glance-surv, echo = F}
glance(survival_mod) %>%
  knitr::kable(caption = 'glance model' )
```




# Larval growth-rates
For both species, exploratory plotting showed that an increase in larval density increased the length of time until both pupation and eclosion (Figure \@ref(fig:growth-box)).  <br>
```{r growth-box, fig.cap="Larval growth-rates", echo = F, warning=F}
box_plot
```

Analysing this data was more difficult as controlling for 'species' in a model by allowing a random slope per-species led to a singular fit. As such, rather than running two models (one for 'time to pupation' and one for 'time to eclosion') with species being included as a factor, we settled for running four models, with each species getting two models. So for each species we have:  

1. days until pupation ~ larval density + (1 | container)
2. days until eclosion ~ larval density + (1 | container)

## Time until pupation  
This used the formula:   
*`r format(formula(pupation_model_kisumu))`*.  
Or, in something closer to plain english:  
*Time until pupation ~ larval density + (1 | container)*  
with this model being ran twice: once per-species.  

### Kisumu

This gave the following values for the species 'Kisumu' (Table \@ref(tab:tidy-k-pup)).  
```{r tidy-k-pup, echo= F}
tidy(pupation_model_kisumu) %>%
  knitr::kable(caption = 'tidy model for Kisumu pupation' )
```

And the following confidence values (Table \@ref(tab:glance-k-pup)).

```{r glance-k-pup, echo = F}
glance(pupation_model_kisumu) %>%
  knitr::kable(caption = 'glance model for Kisumu pupation' )
```


### Opeibea

This gave the following values for the species 'Opeibea' (Table \@ref(tab:tidy-o-pup)).  
```{r tidy-o-pup, echo= F}
tidy(pupation_model_opeibea) %>%
  knitr::kable(caption = 'tidy model for Opeibea pupation' )
```

And the following confidence values (Table \@ref(tab:glance-o-pup)).

```{r glance-o-pup, echo = F}
glance(pupation_model_opeibea) %>%
  knitr::kable(caption = 'glance model for Opeibea pupation' )
```


## Time until eclosion  
This used the formula:   
*`r format(formula(eclosion_model_kisumu))`*.  
Or, in something closer to plain english:  
*Time until eclosion ~ larval density + (1 | container)*  
with this model being ran twice: once per-species.  

### Kisumu

This gave the following values for the species 'Kisumu' (Table \@ref(tab:tidy-k-ecl)).  
```{r tidy-k-ecl, echo= F}
tidy(eclosion_model_kisumu) %>%
  knitr::kable(caption = 'tidy model for Kisumu eclosion' )
```

And the following confidence values (Table \@ref(tab:glance-k-ecl)).

```{r glance-k-ecl, echo = F}
glance(eclosion_model_kisumu) %>%
  knitr::kable(caption = 'glance model for Kisumu eclosion' )
```


### Opeibea

This gave the following values for the species 'Opeibea' (Table \@ref(tab:tidy-o-ecl)).  
```{r tidy-o-ecl, echo= F}
tidy(eclosion_model_opeibea) %>%
  knitr::kable(caption = 'tidy model for Opeibea eclosion' )
```

And the following confidence values (Table \@ref(tab:glance-o-ecl)).

```{r glance-o-ecl, echo = F}
glance(eclosion_model_opeibea) %>%
  knitr::kable(caption = 'glance model for Opeibea eclosion' )
```


