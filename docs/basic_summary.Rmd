---
title: "Larval density dependence"
author: "Andreas Kudom, Dave Hemprich-Bennett, Talya Hackett"
date: "06/07/2022"
output: bookdown::html_document2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(here)

# Rerun scripts
source(here('scripts', '1_larval_growth_rates.R'))
source(here('scripts', '2_larval_mortality.R'))
source(here('scripts', '3_wing_size.R'))

# read in formatted df
larval_density_df <- read_csv(here('data', 'processed_data', '1_density_and_growth.csv')) 
sp <- larval_density_df %>% pull(species) %>% unique()
```

# Introduction

Andreas ran an experiment where containers had `r larval_density_df %>% pull(larval_density) %>% unique()` *Anopheles gambiae* eggs placed within them. 
`r larval_density_df %>% pull(replicate_no) %>% unique() %>% (length)` simultaneous replicates of different larval densities were performed, over `r larval_density_df %>% pull(date_of_experiment) %>% unique() %>% length()` iterations. 
Iterations either had `r sp[1]` or `r sp[2]` varieties used.  
Three sets of variables were measured:  

1. Number of larvae per surviving until pupation per replicate
2. For larvae that survived until pupation, number of days between hatching and:
    + pupation
    + eclosion
3. Wing length for a subset of larvae that survived until eclosion.


# Survival rates

Increasing the density of larvae in a container decreased the proportion of those larvae who survived (Figure \@ref(fig:prop-surv)).

```{r prop-surv, fig.cap="Proportion of larvae surviving."}
proportion_survival_boxplot
```



This data was analysed using a binomial generalised linear mixed-effects model, using the formula:   
*`r format(formula(survival_mod))`*.  
Or, in something closer to plain english:  
*survival (a binary variable) ~ larval density + larval 'species' + (1 | container)*  
Where larval density is being treated as a categorical variable.  

The model gave the following values (Table \@ref(tab:tidy-surv)).  
```{r tidy-surv, echo= F}
tidy(survival_mod) %>%
  knitr::kable(caption = 'tidy model' )
```

And the following confidence values (Table \@ref(tab:glance-surv)).

```{r glance-surv, echo = F}
glance(survival_mod) %>%
  knitr::kable(caption = 'glance model' )
```




# Larval growth-rates
For both species, exploratory plotting showed that an increase in larval density increased the length of time until both pupation and eclosion (Figure \@ref(fig:growth-box)).  <br>
```{r growth-box, fig.cap="Larval growth-rates", echo = F, warning=F}
box_plot
```

Analysing this data was more difficult as controlling for 'species' in a model by allowing a random slope per-species led to a singular fit. As such, rather than running two models (one for 'time to pupation' and one for 'time to eclosion') with species being included as a factor, we settled for running four models, with each species getting two models. So for each species we have:  

1. days until pupation ~ larval density + (1 | container)
2. days until eclosion ~ larval density + (1 | container)

## Time until pupation  
This used the formula:   
*`r format(formula(pupation_model_kisumu))`*.  
Or, in something closer to plain english:  
*Time until pupation ~ larval density + (1 | container)*  
with this model being ran twice: once per-species.  

### Kisumu

This gave the following values for the species 'Kisumu' (Table \@ref(tab:tidy-k-pup)).  
```{r tidy-k-pup, echo= F}
tidy(pupation_model_kisumu) %>%
  knitr::kable(caption = 'tidy model for Kisumu pupation' )
```

And the following confidence values (Table \@ref(tab:glance-k-pup)).

```{r glance-k-pup, echo = F}
glance(pupation_model_kisumu) %>%
  knitr::kable(caption = 'glance model for Kisumu pupation' )
```


### Opeibea

This gave the following values for the species 'Opeibea' (Table \@ref(tab:tidy-o-pup)).  
```{r tidy-o-pup, echo= F}
tidy(pupation_model_opeibea) %>%
  knitr::kable(caption = 'tidy model for Opeibea pupation' )
```

And the following confidence values (Table \@ref(tab:glance-o-pup)).

```{r glance-o-pup, echo = F}
glance(pupation_model_opeibea) %>%
  knitr::kable(caption = 'glance model for Opeibea pupation' )
```


## Time until eclosion  
This used the formula:   
*`r format(formula(eclosion_model_kisumu))`*.  
Or, in something closer to plain english:  
*Time until eclosion ~ larval density + (1 | container)*  
with this model being ran twice: once per-species.  

### Kisumu

This gave the following values for the species 'Kisumu' (Table \@ref(tab:tidy-k-ecl)).  
```{r tidy-k-ecl, echo= F}
tidy(eclosion_model_kisumu) %>%
  knitr::kable(caption = 'tidy model for Kisumu eclosion' )
```

And the following confidence values (Table \@ref(tab:glance-k-ecl)).

```{r glance-k-ecl, echo = F}
glance(eclosion_model_kisumu) %>%
  knitr::kable(caption = 'glance model for Kisumu eclosion' )
```


### Opeibea

This gave the following values for the species 'Opeibea' (Table \@ref(tab:tidy-o-ecl)).  
```{r tidy-o-ecl, echo= F}
tidy(eclosion_model_opeibea) %>%
  knitr::kable(caption = 'tidy model for Opeibea eclosion' )
```

And the following confidence values (Table \@ref(tab:glance-o-ecl)).

```{r glance-o-ecl, echo = F}
glance(eclosion_model_opeibea) %>%
  knitr::kable(caption = 'glance model for Opeibea eclosion' )
```


# Larval density and wing length

Wing length was measured for a subset of the adult mosquitoes, showing a decrease in wing length when they were kept in containers with a greater larval density (See Table \@ref(tab:winglength-summary) and Figure \@ref(fig:winglength-boxplot))

```{r winglength-summary}
larval_summary_stats %>%
  mutate(`Mean winglength (um)` = round(`Mean winglength (um)`, 1),
            `Winglength standard deviation` = round(`Winglength standard deviation`, 1)) %>%
  knitr::kable(caption = 'Basic summary statistics of the adult mosquito wing lengths. Mean and s.d. shown rounded to 1 decimal place.')
```

```{r winglength-boxplot, fig.cap= 'Boxplot of the wing length of adult mosquitoes kept at various larval densities'}
wingsize_boxplot
```

A one-way ANOVA was ran on this dataset, showing that there was a significant effect of larval density on adult wing length. For the overall model F =  `r tidy(wing_aov)$statistic[1] %>% round(., 2)` and p = `r ifelse(tidy(wing_aov)$p.value[1]  < 0.001, '<0.001', tidy(wing_aov)$p.value[1])`,  see Table \@ref(tab:aov-output). 

```{r aov-output}
tidy(wing_aov) %>%
  knitr::kable(caption = 'ANOVA output')
```
Tukey's HSD test was ran on the ANOVA model, showing that there was a significant difference between the 10L treatment and both other treatments, but not between 60L and 200L (\@ref(tab:tukey-output)).
```{r tukey-output}
TukeyHSD(wing_aov) %>%
  tidy() %>%
  knitr::kable(caption = 'Tukeys HSD output')
```

